<!-- Explorer View -->
<div class="explorer-container h-100">
  <!-- Toolbar -->
  <div class="toolbar">
    <!-- Left Section: URL, Branch, Analyze -->
    <div class="toolbar-left">
      <!-- Git URL Input -->
      <div class="input-group url-input">
        <span class="input-group-text">
          <span class="material-icons">link</span>
        </span>
        <input type="text" class="form-control" placeholder="Git Repository URL" 
               [(ngModel)]="repoUrl">
      </div>

      <!-- Branch Input -->
      <div class="input-group branch-input">
        <span class="input-group-text">
          <span class="material-icons">fork_right</span>
        </span>
        <input type="text" class="form-control" placeholder="Branch (optional)" 
               [(ngModel)]="branch">
      </div>

      <!-- Analyze Button -->
      <button type="button" class="btn btn-primary analyze-btn" 
              (click)="analyze()" [disabled]="isAnalyzing">
        <span class="material-icons me-1">analytics</span>
        {{ isAnalyzing ? 'Analyzing...' : 'Analyze' }}
      </button>
    </div>

    <!-- Center Section: Scope Toggle, Search -->
    <div class="toolbar-center">
      <!-- Scope Toggle -->
      <div class="btn-group" role="group">
        <input type="radio" class="btn-check" name="scope" id="namespace-scope" 
               value="namespace" [checked]="currentScope === 'namespace'"
               (change)="onScopeChange('namespace')">
        <label class="btn btn-outline-secondary" for="namespace-scope">
          <span class="material-icons me-1">account_tree</span>
          Namespace
        </label>
        
        <input type="radio" class="btn-check" name="scope" id="file-scope" 
               value="file" [checked]="currentScope === 'file'"
               (change)="onScopeChange('file')">
        <label class="btn btn-outline-secondary" for="file-scope">
          <span class="material-icons me-1">description</span>
          File
        </label>
      </div>

      <!-- Search -->
      <div class="input-group search-input">
        <span class="input-group-text">
          <span class="material-icons">search</span>
        </span>
        <input type="text" class="form-control" placeholder="Search nodes..." 
               [value]="searchTerm" (input)="onSearchChange(($any($event.target)).value)">
      </div>


    </div>

    <!-- Right Section: Export, Save/Load -->
    <div class="toolbar-right">
      <!-- Export Dropdown -->
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" 
                type="button" data-bs-toggle="dropdown">
          <span class="material-icons me-1">file_download</span>
          Export
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#" (click)="exportPNG()">
            <span class="material-icons me-2">image</span>PNG
          </a></li>
          <li><a class="dropdown-item" href="#" (click)="exportSVG()">
            <span class="material-icons me-2">vector_graphic</span>SVG
          </a></li>
          <li><a class="dropdown-item" href="#" (click)="exportJSON()">
            <span class="material-icons me-2">code</span>JSON
          </a></li>
        </ul>
      </div>

      <!-- Save/Load -->
      <div class="btn-group">
        <button type="button" class="btn btn-outline-secondary" 
                (click)="save()">
          <span class="material-icons me-1">save</span>
          Save
        </button>
        <button type="button" class="btn btn-outline-secondary" 
                (click)="load()">
          <span class="material-icons me-1">folder_open</span>
          Load
        </button>
      </div>
    </div>
  </div>

  <!-- Error Display -->
  <div class="error-alert alert alert-danger alert-dismissible fade show" 
       *ngIf="error" role="alert">
    <span class="material-icons me-2">error</span>
    {{ error }}
    <button type="button" class="btn-close" (click)="clearError()"></button>
  </div>

  <!-- Main Content Area -->
  <div class="main-area d-flex h-100">
    <!-- Left Filter Tree -->
    <div class="filter-tree-panel" *ngIf="analysisResult && !isAnalyzing">
      <app-filter-tree
        [analysisResult]="analysisResult"
        [currentScope]="currentScope"
        [hiddenNodes]="filterState.hiddenNodes"
        (nodesVisibilityChanged)="onNodesVisibilityChanged($event)">
      </app-filter-tree>
    </div>

    <!-- Graph Canvas Area -->
    <div class="graph-area flex-grow-1 d-flex align-items-center justify-content-center">
      <!-- Placeholder for no analysis -->
      <div class="placeholder-content" *ngIf="!analysisResult && !isAnalyzing">
        <span class="material-icons">hub</span>
        <h4>Enter a Git repository URL and click Analyze to get started</h4>
        <p>CodeAtlas will analyze the C# codebase and show dependency graphs</p>
      </div>
      
      <!-- Loading state -->
      <div class="loading-content" *ngIf="isAnalyzing">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Analyzing...</span>
        </div>
        <h5>Analyzing repository...</h5>
        <p>This may take a few minutes for large repositories</p>
      </div>

      <!-- Graph Canvas -->
      <div *ngIf="analysisResult && !isAnalyzing" style="position: relative; width: 100%; height: 100%;">
        <!-- Graph Info Panel -->
        <div class="graph-info-panel">
          <div class="info-item">
            <span class="info-label">Nodes:</span>
            <span class="info-value">{{ getNodeCount() }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Edges:</span>
            <span class="info-value">{{ getEdgeCount() }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Scope:</span>
            <span class="info-value">{{ currentScope }}</span>
          </div>
          <div class="info-item" *ngIf="selectedNode">
            <span class="info-label">Selected:</span>
            <span class="info-value">{{ selectedNode.label }}</span>
          </div>
        </div>
        
        <app-graph-canvas
          [analysisResult]="analysisResult"
          [currentScope]="currentScope"
          [searchTerm]="searchTerm"
          [filterState]="filterState"
          (nodeSelected)="onNodeSelected($event)"
          (filterStateChanged)="onFilterStateChanged($event)">
        </app-graph-canvas>
      </div>
    </div>
  </div>

  <!-- Right Drawer -->
  <app-node-details-drawer
    [selectedNode]="selectedNode"
    [neighborsOnly]="filterState.neighborsOnly"
    (closeRequested)="onCloseDrawer()"
    (impactRequested)="onImpactRequested($event)"
    (pathsRequested)="onPathsRequested($event)"
    (neighborsOnlyToggled)="onNeighborsOnlyToggled($event)">
  </app-node-details-drawer>
</div>
